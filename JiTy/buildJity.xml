<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<project basedir="." default="build" name="jity">
	<property name="version" value="0.0.1"/>
	<property name="app.home" value="."/>
	<property name="cible.dir" value="d:\temp\jity"/>
	<property name="src.dir" value="${app.home}/src"/>
	<property name="build.dir" value="${cible.dir}/build"/>
	<property name="dist.dir" value="${cible.dir}/dist"/>
	<property name="dist.server.dir" value="${dist.dir}/jityServer-${version}"/>
	<property name="dist.agent.dir" value="${dist.dir}/jityAgent-${version}"/>
	<property name="dist.uiclient.dir" value="${dist.dir}/jityUIClient-${version}"/>

	<path id="jity.classpath">
      <fileset dir="lib">
        <include name="log4j-1.2.15.jar"/>
        <include name="xstream-1.4.1.jar"/>
      	<include name="h2_db-1.3.167/h2-1.3.167.jar"/>
      	<include name="hibernate-4.1.1/*.jar"/>
      </fileset>
	</path>

	<path id="agent.src"> 
	     <pathelement path="${src.dir}/org/jity/agent" /> 
	     <pathelement path="${src.dir}/org/jity/common" />
	</path> 
		
	<target name="init">
		<mkdir dir="${build.dir}" />
		<mkdir dir="${dist.dir}" />
		<mkdir dir="${dist.server.dir}" />
		<mkdir dir="${dist.agent.dir}" />
		<mkdir dir="${dist.uiclient.dir}" />
	</target>

	<target name="clean">
		<delete dir="${build.dir}"/>
		<delete dir="${dist.dir}"/>
	</target>

	<target name="build" depends="clean, init, build-agent"/>

	<target name="build-agent">
		<echo message="Debut de compilation: ${ant.project.name} (${ant.file})"/>
		<mkdir dir="${build.dir}/conf" />
		<mkdir dir="${build.dir}/lib" />

		 <property name="agent.src" refid="agent.src"/> 
		<javac debug="true"
			target="1.6"
			srcdir="${agent.src}"
			destdir="${build.dir}">
			<classpath refid="jity.classpath"/>
		</javac>

		<copy todir="${build.dir}/lib">
			<fileset dir="${app.home}/lib">
				<include name="log4j-1.2.15.jar"/>
				<include name="xstream-1.4.1.jar"/>
			</fileset>
		</copy>

		<copy todir="${build.dir}/conf">
			<fileset dir="${app.home}/conf">
				<include name="AgentConfig.xml"/>
				<include name="log4j.xml"/>
			</fileset>
		</copy>

		<echo message="Fin de compilation: ${ant.project.name} (${ant.file})"/>
	</target>

	<target name="distAgent" depends="build, dist-agent"/>

	<target name="dist-agent" depends="build-agent">
		<mkdir dir="${dist.agent.dir}/log" />
		<mkdir dir="${dist.ecf.dir}/lib" />
		<mkdir dir="${dist.ecf.dir}/conf" />

		<manifestclasspath property="jar.ecf.classpath" jarfile="editeurCF.jar">
			<classpath refid="IDPV2.classpath" />
		</manifestclasspath>

		<jar destfile="${dist.ecf.dir}/editeurChaine.jar">
			<manifest>
				<attribute name="Main-Class" value="maif.idpv2.editeurChaine.EditeurChaine" />
				<attribute name="Class-Path" value="${jar.ecf.classpath}" />
			</manifest>
			<fileset dir="${build.dir}">
				<exclude name="local/**" />
				<exclude name="lib/**" />
			</fileset>
		</jar>
		<copy todir="${dist.ecf.dir}">
			<fileset dir="${build.dir}/local">
				<include name="*.bat"/>
			</fileset>
		</copy>
		<copy todir="${dist.ecf.dir}/lib">
			<fileset dir="${build.dir}/lib"/>
		</copy>
		<copy todir="${dist.ecf.dir}/conf">
			<fileset dir="${build.dir}/local/conf">
				<include name="EditeurChaine*"/>
				<include name="sites.csv"/>
				<include name="fonctionParamInit*"/>
				<include name="log4j.xml"/>
			</fileset>
		</copy>
		<copy todir="${dist.ecf.dir}/simuFicInit">
			<fileset dir="${build.dir}/local/simuFicInit"/>
		</copy>
	</target>



</project>
